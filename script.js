const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

// Karakter pemain (rectangle merah dengan "tangan" animasi)
let player = {
    x: 100,
        y: 450,
            width: 50,
                height: 50,
                    vx: 0,
                        vy: 0,
                            health: 100,
                                punching: false,
                                    punchTimer: 0
                                    };

                                    // Karakter musuh (rectangle biru dengan "tangan" animasi)
                                    let enemy = {
                                        x: 700,
                                            y: 450,
                                                width: 50,
                                                    height: 50,
                                                        vx: 0,
                                                            vy: 0,
                                                                health: 100,
                                                                    punching: false,
                                                                        punchTimer: 0
                                                                        };

                                                                        const gravity = 0.5;
                                                                        let gameOver = false;

                                                                        // Kontrol tombol virtual
                                                                        document.getElementById('left-btn').addEventListener('touchstart', () => player.vx = -5);
                                                                        document.getElementById('left-btn').addEventListener('touchend', () => player.vx = 0);
                                                                        document.getElementById('right-btn').addEventListener('touchstart', () => player.vx = 5);
                                                                        document.getElementById('right-btn').addEventListener('touchend', () => player.vx = 0);
                                                                        document.getElementById('jump-btn').addEventListener('touchstart', () => {
                                                                            if (player.y >= 450) player.vy = -10; // Lompat jika di tanah
                                                                            });
                                                                            document.getElementById('punch-btn').addEventListener('touchstart', () => {
                                                                                if (Math.abs(player.x - enemy.x) < 100) {
                                                                                        enemy.health -= 10;
                                                                                                enemy.punching = true;
                                                                                                        enemy.punchTimer = 10; // Efek pukul 10 frame
                                                                                                            }
                                                                                                            });

                                                                                                            // Kontrol keyboard
                                                                                                            document.addEventListener('keydown', (e) => {
                                                                                                                if (e.key === 'a' || e.key === 'A') player.vx = -5;
                                                                                                                    if (e.key === 'd' || e.key === 'D') player.vx = 5;
                                                                                                                        if (e.key === 'w' || e.key === 'W') {
                                                                                                                                if (player.y >= 450) player.vy = -10;
                                                                                                                                    }
                                                                                                                                        if (e.key === ' ') {
                                                                                                                                                if (Math.abs(player.x - enemy.x) < 100) {
                                                                                                                                                            enemy.health -= 10;
                                                                                                                                                                        enemy.punching = true;
                                                                                                                                                                                    enemy.punchTimer = 10;
                                                                                                                                                                                            }
                                                                                                                                                                                                }
                                                                                                                                                                                                });
                                                                                                                                                                                                document.addEventListener('keyup', (e) => {
                                                                                                                                                                                                    if (e.key === 'a' || e.key === 'A' || e.key === 'd' || e.key === 'D') player.vx = 0;
                                                                                                                                                                                                    });

                                                                                                                                                                                                    function update() {
                                                                                                                                                                                                        if (gameOver) return;

                                                                                                                                                                                                            // Update pemain
                                                                                                                                                                                                                player.x += player.vx;
                                                                                                                                                                                                                    player.y += player.vy;
                                                                                                                                                                                                                        player.vy += gravity;
                                                                                                                                                                                                                            if (player.y > 450) {
                                                                                                                                                                                                                                    player.y = 450;
                                                                                                                                                                                                                                            player.vy = 0;
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                    if (player.x < 0) player.x = 0;
                                                                                                                                                                                                                                                        if (player.x > 750) player.x = 750;

                                                                                                                                                                                                                                                            // Update musuh (AI sederhana)
                                                                                                                                                                                                                                                                if (enemy.x < player.x - 50) enemy.vx = 2;
                                                                                                                                                                                                                                                                    else if (enemy.x > player.x + 50) enemy.vx = -2;
                                                                                                                                                                                                                                                                        else enemy.vx = 0;
                                                                                                                                                                                                                                                                            enemy.x += enemy.vx;
                                                                                                                                                                                                                                                                                if (enemy.x < 0) enemy.x = 0;
                                                                                                                                                                                                                                                                                    if (enemy.x > 750) enemy.x = 750;

                                                                                                                                                                                                                                                                                        // Update animasi pukul
                                                                                                                                                                                                                                                                                            if (player.punchTimer > 0) player.punchTimer--;
                                                                                                                                                                                                                                                                                                else player.punching = false;
                                                                                                                                                                                                                                                                                                    if (enemy.punchTimer > 0) enemy.punchTimer--;
                                                                                                                                                                                                                                                                                                        else enemy.punching = false;

                                                                                                                                                                                                                                                                                                            // Cek kemenangan
                                                                                                                                                                                                                                                                                                                if (player.health <= 0) {
                                                                                                                                                                                                                                                                                                                        ctx.fillStyle = '#ff0000';
                                                                                                                                                                                                                                                                                                                                ctx.font = '40px Arial';
                                                                                                                                                                                                                                                                                                                                        ctx.fillText('Kalah!', 350, 300);
                                                                                                                                                                                                                                                                                                                                                gameOver = true;
                                                                                                                                                                                                                                                                                                                                                    } else if (enemy.health <= 0) {
                                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = '#00ff00';
                                                                                                                                                                                                                                                                                                                                                                    ctx.font = '40px Arial';
                                                                                                                                                                                                                                                                                                                                                                            ctx.fillText('Menang!', 350, 300);
                                                                                                                                                                                                                                                                                                                                                                                    gameOver = true;
                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                        function draw() {
                                                                                                                                                                                                                                                                                                                                                                                            // Background
                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillStyle = '#87CEEB';
                                                                                                                                                                                                                                                                                                                                                                                                    ctx.fillRect(0, 0, 800, 600);

                                                                                                                                                                                                                                                                                                                                                                                                        // Tanah
                                                                                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = '#8B4513';
                                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillRect(0, 500, 800, 100);

                                                                                                                                                                                                                                                                                                                                                                                                                    // Gambar pemain (rectangle merah dengan tangan)
                                                                                                                                                                                                                                                                                                                                                                                                                        ctx.fillStyle = '#ff0000';
                                                                                                                                                                                                                                                                                                                                                                                                                            ctx.fillRect(player.x, player.y, player.width, player.height);
                                                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillStyle = '#000';
                                                                                                                                                                                                                                                                                                                                                                                                                                    ctx.fillRect(player.x + 40, player.y + 10, 20, 10); // Tangan kanan
                                                                                                                                                                                                                                                                                                                                                                                                                                        if (player.punching) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillRect(player.x + 50, player.y + 5, 30, 5); // Tangan maju saat pukul
                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Gambar musuh (rectangle biru dengan tangan)
                                                                                                                                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = '#0000ff';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ctx.fillStyle = '#000';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ctx.fillRect(enemy.x - 20, enemy.y + 10, 20, 10); // Tangan kiri
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (enemy.punching) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ctx.fillRect(enemy.x - 40, enemy.y + 5, 30, 5); // Tangan maju saat pukul
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // UI Health
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ctx.fillStyle = '#000';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ctx.font = '20px Arial';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ctx.fillText('Health Pemain: ' + player.health, 10, 30);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ctx.fillText('Health Musuh: ' + enemy.health, 600, 30);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                update();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!gameOver) requestAnimationFrame(draw);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    draw(); // Mulai game